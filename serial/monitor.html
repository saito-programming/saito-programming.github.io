<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>micro:bit Serial Monitor</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f0f0f0; }
        #connect { padding: 10px 20px; font-size: 1.2rem; cursor: pointer;  border-radius: 5px; border: none;background: #0078d7; color: white; }
        
        /* å‡ºåŠ›ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #output {
            margin: 20px auto;
            width: 60%;
            height: 200px;
            background-color: #000; /* èƒŒæ™¯ï¼šé»’ */
            color: #fff;            /* æ–‡å­—ï¼šç™½ */
            padding: 15px;
            overflow-y: scroll;
            text-align: left;
            font-family: 'Courier New', Courier, monospace;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            line-height: 1.5;
        }
        .log-line { border-bottom: 1px solid #333; margin: 0; padding: 2px 0; }
        .tag { color: #0f0; margin-right: 10px; } /* å—ä¿¡ãƒ©ãƒ™ãƒ«ã‚’ç·‘ã« */
    </style>
</head>
<body>

    <h1>micro:bit ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ãƒ¢ãƒ‹ã‚¿ãƒ¼</h1>
    <button id="connect">ãƒã‚¤ã‚¯ãƒ­ãƒ“ãƒƒãƒˆã«æ¥ç¶šã™ã‚‹(baudRateï¼š115200bps)</button>

    <div id="output">
        <p style="color: #888;">ã“ã“ã«å—ä¿¡ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™...</p>
    </div>

    <script>
        const connectBtn = document.getElementById('connect');
        const outputDiv = document.getElementById('output');

        connectBtn.addEventListener('click', async () => {
            try {
                // ã‚·ãƒªã‚¢ãƒ«ãƒãƒ¼ãƒˆã®è¦æ±‚
                const port = await navigator.serial.requestPort();
                await port.open({ baudRate: 115200 });

                connectBtn.textContent = "ğŸ”Œ æ¥ç¶šä¸­...";
                connectBtn.disabled = true;
                outputDiv.innerHTML = ""; // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆå»

                const decoder = new TextDecoderStream();
                port.readable.pipeTo(decoder.writable);
                const reader = decoder.readable.getReader();

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    if (value) {
                        // micro:bitã‹ã‚‰ã®æ–‡å­—åˆ—ã‚’è¡¨ç¤ºï¼ˆæ”¹è¡Œã‚³ãƒ¼ãƒ‰ãªã©ã®ãƒˆãƒªãƒŸãƒ³ã‚°ï¼‰
                        const cleanText = value.trim();
                        if (cleanText) {
                            const p = document.createElement('p');
                            p.className = 'log-line';
                            p.innerHTML = `<span class="tag">[å—ä¿¡]</span>${cleanText}`;
                            outputDiv.appendChild(p);
                            
                            // å¸¸ã«æœ€æ–°ã®è¡ŒãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                            outputDiv.scrollTop = outputDiv.scrollHeight;
                        }
                    }
                }
            } catch (error) {
                console.error(error);
                alert("æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            }
        });
    </script>
</body>
</html>
